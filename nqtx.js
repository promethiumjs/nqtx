let $15882dbcd04d9f27$var$currentEntity,$15882dbcd04d9f27$var$getCurrentStoreMethod,$15882dbcd04d9f27$var$getCurrentStoreIdMethod,$15882dbcd04d9f27$var$renderComponentMethod,$15882dbcd04d9f27$var$getPreventMultipleRendersMethod,$15882dbcd04d9f27$var$setPreventMultipleRendersMethod;function $15882dbcd04d9f27$export$33b9e1ccb5643ac8(entity){$15882dbcd04d9f27$var$currentEntity=entity}function $15882dbcd04d9f27$export$5676a8a1d49c85be(){return $15882dbcd04d9f27$var$currentEntity}function $15882dbcd04d9f27$export$9d75f3e1a7e94aee(storeId){return $15882dbcd04d9f27$var$getCurrentStoreMethod(storeId)}function $15882dbcd04d9f27$export$9e78cbb868ddafad(){return $15882dbcd04d9f27$var$getCurrentStoreIdMethod()}function $15882dbcd04d9f27$export$fa7f552cb3a457a6(storeId){$15882dbcd04d9f27$var$renderComponentMethod(storeId)}function $15882dbcd04d9f27$export$e7f1d62916683ee7(){return $15882dbcd04d9f27$var$getPreventMultipleRendersMethod}function $15882dbcd04d9f27$export$743647d42396ef87(boolean){$15882dbcd04d9f27$var$setPreventMultipleRendersMethod(boolean)}function $15882dbcd04d9f27$export$6ceec5925def9744({getCurrentStore:getCurrentStore,getCurrentStoreId:getCurrentStoreId,renderComponent:renderComponent,getPreventMultipleRenders:getPreventMultipleRenders,setPreventMultipleRenders:setPreventMultipleRenders}){$15882dbcd04d9f27$var$getCurrentStoreMethod=getCurrentStore,$15882dbcd04d9f27$var$getCurrentStoreIdMethod=getCurrentStoreId,$15882dbcd04d9f27$var$renderComponentMethod=renderComponent,$15882dbcd04d9f27$var$getPreventMultipleRendersMethod=getPreventMultipleRenders,$15882dbcd04d9f27$var$setPreventMultipleRendersMethod=setPreventMultipleRenders}class $97020ee417fa4c70$export$2e2bcd8739ae039{constructor(initial){this.particles={states:initial&&initial.particleStates||{},mutators:{},derivativeSubs:{},componentSubs:{},otherSubs:{},otherSubs_instant:{}},this._particles={},this.derivatives={states:initial&&initial.derivativeStates||{},transforms:{},particleSubs:{},componentSubs:{},otherSubs:{},otherSubs_instant:{}},this._derivatives={},this.triggers={subscriptions:{}},this._triggers={}}static create(initialParticleStates){const entity=new $97020ee417fa4c70$export$2e2bcd8739ae039(initialParticleStates);return $15882dbcd04d9f27$export$33b9e1ccb5643ac8(entity),entity}addAdaptationMethods(methods){$15882dbcd04d9f27$export$6ceec5925def9744(methods)}set({particleId:particleId3,newState:newState1}){const _particle=this._particles[particleId3],states=this.particles.states,derivativeSubs=this.particles.derivativeSubs,componentSubs=this.particles.componentSubs,otherSubs=this.particles.otherSubs,otherSubs_instant=this.particles.otherSubs_instant;void 0!==_particle.previous&&(_particle.previous=_particle.state),void 0!==newState1?(_particle.state=newState1,states[particleId3]=newState1):(_particle.state=null,states[particleId3]=null),$15882dbcd04d9f27$export$743647d42396ef87(!0),otherSubs_instant[particleId3]&&otherSubs_instant[particleId3].forEach((listener=>listener(newState1))),derivativeSubs[particleId3]&&derivativeSubs[particleId3].forEach((derivativeId=>this.update({derivativeId:derivativeId}))),componentSubs[particleId3]&&componentSubs[particleId3].forEach((storeId=>$15882dbcd04d9f27$export$fa7f552cb3a457a6(storeId))),otherSubs[particleId3]&&setTimeout((()=>otherSubs[particleId3].forEach((listener=>listener(newState1))))),$15882dbcd04d9f27$export$743647d42396ef87(!1)}get({particleId:particleId1,derivativeId:derivativeId,firstTime:firstTime}){const states=this.particles.states;if(void 0===states[particleId1])throw console.error(`The particle you are trying to access with id: ${particleId1} doesn't exist`),new Error(`Cannot access state of particle: "${particleId1}"`);if(firstTime){const derivativeSubs=this.particles.derivativeSubs;if(derivativeSubs[particleId1]){if(derivativeSubs[particleId1].includes(derivativeId))return states[particleId1];derivativeSubs[particleId1].push(derivativeId)}else derivativeSubs[particleId1]=[],derivativeSubs[particleId1].push(derivativeId);const particleSubs=this.derivatives.particleSubs,unsubscribe=()=>{try{const index=derivativeSubs[particleId1].indexOf(derivativeId);derivativeSubs[particleId1].splice(index,1)}catch(err){}};particleSubs[derivativeId]||(particleSubs[derivativeId]=[]),particleSubs[derivativeId].push(unsubscribe)}return states[particleId1]}getPrevious({particleId:particleId2,derivativeId:derivativeId1,firstTime:firstTime1}){const _particle=this._particles[particleId2];if(void 0===_particle.previous)throw console.error(`The particle you are trying to access with id: ${particleId2} either \n        doesn't exist or doesn't have it's "previousState" flag set to true`),new Error(`Cannot access previous state of particle: "${particleId2}"`);if(firstTime1){const derivativeSubs=this.particles.derivativeSubs;if(derivativeSubs[particleId2]){if(derivativeSubs[particleId2].includes(derivativeId1))return _particle.previous;derivativeSubs[particleId2].push(derivativeId1)}else derivativeSubs[particleId2]=[],derivativeSubs[particleId2].push(derivativeId1);const particleSubs=this.derivatives.particleSubs,unsubscribe=()=>{try{const index=derivativeSubs[particleId2].indexOf(derivativeId1);derivativeSubs[particleId2].splice(index,1)}catch(err){}};particleSubs[derivativeId1]||(particleSubs[derivativeId1]=[]),particleSubs[derivativeId1].push(unsubscribe)}return _particle.previous}update({derivativeId:derivativeId2}){const _derivative=this._derivatives[derivativeId2],states=this.derivatives.states,transforms=this.derivatives.transforms,componentSubs=this.derivatives.componentSubs,otherSubs=this.derivatives.otherSubs,otherSubs_instant=this.derivatives.otherSubs_instant;let newState;void 0!==_derivative.previous&&(_derivative.previous=_derivative.state);try{newState=transforms[derivativeId2]({get:particleId=>this.get({particleId:particleId,derivativeId:derivativeId2}),getPrevious:particleId=>this.getPrevious({particleId:particleId}),state:states[derivativeId2]})}catch(err){newState=null}void 0!==newState?(_derivative.state=newState,states[derivativeId2]=newState):(_derivative.state=null,states[derivativeId2]=null),otherSubs_instant[derivativeId2]&&otherSubs_instant[derivativeId2].forEach((listener=>listener(newState))),componentSubs[derivativeId2]&&componentSubs[derivativeId2].forEach((storeId=>$15882dbcd04d9f27$export$fa7f552cb3a457a6(storeId))),otherSubs[derivativeId2]&&setTimeout((()=>otherSubs[derivativeId2].forEach((listener=>listener(newState)))))}getParticleStates(){return this.particles.states}getDerivativeStates(){return this.derivatives.states}getParticle({id:id,storeId:storeId}){if(!this._particles[id])throw console.error(`You are trying to access a particle with id: "${id}" that doesn't yet exist`),new Error(`Particle: "${id}" is not accessible`);if(storeId){const componentSubs=this.particles.componentSubs;componentSubs[id]||(componentSubs[id]=[]),componentSubs[id].push(storeId);const unsubscribe=()=>{try{const index=componentSubs[id].indexOf(storeId);componentSubs[id].splice(index,1)}catch(err){}};return[this._particles[id],unsubscribe]}return this._particles[id]}setParticle({id:id1,initialState:initialState,mutator:mutator,previousState:previousState}){const states=this.particles.states,mutators=this.particles.mutators,derivativeSubs=this.particles.derivativeSubs,componentSubs=this.particles.componentSubs,otherSubs=this.particles.otherSubs,otherSubs_instant=this.particles.otherSubs_instant;void 0!==initialState?states[id1]=initialState:void 0===states[id1]&&(states[id1]=null),mutator&&(mutators[id1]=mutator),this._particles[id1]={state:states[id1],get:()=>states[id1],mutate:(mutation,payload)=>{this.set({particleId:id1,newState:mutators[id1][mutation]({state:states[id1],payload:payload})})},set:newState=>this.set({particleId:id1,newState:newState}),subscribe:listener=>(otherSubs[id1]||(otherSubs[id1]=[]),otherSubs[id1].push(listener),()=>{try{const index=otherSubs[id1].indexOf(listener);otherSubs[id1].splice(index,1)}catch(err){}}),subscribe_instant:listener=>(otherSubs_instant[id1]||(otherSubs_instant[id1]=[]),otherSubs_instant[id1].push(listener),()=>{try{const index=otherSubs_instant[id1].indexOf(listener);otherSubs_instant[id1].splice(index,1)}catch(err){}}),detonate:()=>{this._particles[id1].state=null,this._particles[id1].previous=null,this._particles[id1].get=null,this._particles[id1].mutate=null,this._particles[id1].set=null,this._particles[id1].subscribe=null,this._particles[id1].subscribe_instant=null,this._particles[id1].detonate=null,delete this._particles[id1],delete states[id1],delete mutators[id1],delete derivativeSubs[id1],delete componentSubs[id1],delete otherSubs[id1],delete otherSubs_instant[id1]}},previousState&&(this._particles[id1].previous=states[id1])}particle({id:id2,initialState:initialState1,mutator:mutator1,overwrite:overwrite,previousState:previousState1}){if(this._particles[id2])return this.getParticle({id:id2});const states=this.particles.states;return states[id2]&&states[id2]&&!overwrite?this.setParticle({id:id2,mutator:mutator1,previousState:previousState1}):this.setParticle({id:id2,initialState:initialState1,mutator:mutator1,previousState:previousState1}),this.getParticle({id:id2})}getDerivative({id:id3,storeId:storeId1}){if(!this._derivatives[id3])throw console.error(`You are trying to access a derivative with id: "${id3}" that doesn't yet exist`),new Error(`Derivative: "${id3}" is not accessible`);if(storeId1){const componentSubs=this.derivatives.componentSubs;componentSubs[id3]||(componentSubs[id3]=[]),componentSubs[id3].push(storeId1);const unsubscribe=()=>{try{const index=componentSubs[id3].indexOf(storeId1);componentSubs[id3].splice(index,1)}catch(err){}};return[this._derivatives[id3],unsubscribe]}return this._derivatives[id3]}setDerivative({id:id4,initialState:initialState2,transform:transform,previousState:previousState2}){const states=this.derivatives.states,transforms=this.derivatives.transforms,particleSubs=this.derivatives.particleSubs,componentSubs=this.derivatives.componentSubs,otherSubs=this.derivatives.otherSubs,otherSubs_instant=this.derivatives.otherSubs_instant;if(transform&&(transforms[id4]=transform),void 0!==initialState2)states[id4]=initialState2;else if(void 0===states[id4]){try{states[id4]=transforms[id4]({get:particleId=>this.get({particleId:particleId,derivativeId:id4,firstTime:!0}),getPrevious:particleId=>this.getPrevious({particleId:particleId,derivativeId:id4,firstTime:!0})})}catch(err){states[id4]=null}void 0===states[id4]&&states[id4]}this._derivatives[id4]={state:states[id4],get:payload=>transforms[id4]({get:particleId=>this.get({particleId:particleId,derivativeId:id4}),getPrevious:particleId=>this.getPrevious({particleId:particleId,derivativeId:id4}),payload:payload,state:states[id4]}),subscribe:listener=>(otherSubs[id4]||(otherSubs[id4]=[]),otherSubs[id4].push(listener),()=>{try{const index=otherSubs[id4].indexOf(listener);otherSubs[id4].splice(index,1)}catch(err){}}),subscribe_instant:listener=>(otherSubs_instant[id4]||(otherSubs_instant[id4]=[]),otherSubs_instant[id4].push(listener),()=>{try{const index=otherSubs_instant[id4].indexOf(listener);otherSubs_instant[id4].splice(index,1)}catch(err){}}),detonate:()=>{this._derivatives[id4].state=null,this._derivatives[id4].previous=null,this._derivatives[id4].get=null,this._derivatives[id4].subscribe=null,this._derivatives[id4].subscribe_instant=null,this._derivatives[id4].detonate=null,particleSubs[id4].forEach((unsubscribe=>unsubscribe())),delete this._derivatives[id4],delete states[id4],delete transforms[id4],delete particleSubs[id4],delete componentSubs[id4],delete otherSubs[id4]}},previousState2&&(this._derivatives[id4].previous=states[id4])}derivative({id:id5,initialState:initialState3,transform:transform1,overwrite:overwrite1,previousState:previousState3}){if(this._derivatives[id5])return this.getDerivative({id:id5});const states=this.derivatives.states;return states[id5]&&states[id5]&&!overwrite1?this.setDerivative({id:id5,transform:transform1,previousState:previousState3}):this.setDerivative({id:id5,initialState:initialState3,transform:transform1,previousState:previousState3}),this.getDerivative({id:id5})}getTrigger({id:id6}){if(!this._triggers[id6])throw console.error(`You are trying to access a trigger with id: "${id6}" that doesn't yet exist`),new Error(`Trigger: "${id6}" is not accessible`);return this._triggers[id6]}setTrigger({id:id7,initialSubscriptions:initialSubscriptions}){const subscriptions=this.triggers.subscriptions;subscriptions[id7]=initialSubscriptions||[],this._triggers[id7]={invoke:(...payload)=>{subscriptions[id7].forEach((listener=>listener(...payload)))},subscribe:listener=>(subscriptions[id7].push(listener),()=>{try{const index=subscriptions[id7].indexOf(listener);subscriptions[id7].splice(index,1)}catch(err){}}),detonate:()=>{this._triggers[id7].invoke=null,this._triggers[id7].subscribe=null,delete this._triggers[id7],delete subscriptions[id7]}}}trigger({id:id8,initialSubscriptions:initialSubscriptions1}){return this._triggers[id8]||this.setTrigger({id:id8,initialSubscriptions:initialSubscriptions1}),this.getTrigger({id:id8})}}function $ece177b0c5651317$var$adaptEntity(){return $15882dbcd04d9f27$export$5676a8a1d49c85be()}var $ece177b0c5651317$export$2e2bcd8739ae039=$ece177b0c5651317$var$adaptEntity;function $9a74da07d11fdf6d$var$adaptParticle(id){const currentStore=$15882dbcd04d9f27$export$9d75f3e1a7e94aee(),currentStoreId=$15882dbcd04d9f27$export$9e78cbb868ddafad(),currentEntity=$15882dbcd04d9f27$export$5676a8a1d49c85be();if(currentStore&&!currentStore.particles&&(currentStore.particles=[],currentStore.currentAdaptationIds.particle=0,currentStore.particleCleanups=[],currentStore.currentAdaptationIds.particleCleanup=0),currentStore){if(!(currentStore.currentAdaptationIds.particle in currentStore.particles)){let particle=currentEntity.getParticle({id:id,storeId:currentStoreId});currentStore.particles[currentStore.currentAdaptationIds.particle]=[particle[0].state,particle[0]],currentStore.particleCleanups[currentStore.currentAdaptationIds.particleCleanup]=particle[1]}let particle0=currentStore.particles[currentStore.currentAdaptationIds.particle];return particle0[0]=particle0[1].state,currentStore.particles[currentStore.currentAdaptationIds.particle++]}throw new Error("adaptParticle() can only be used inside a Component or a Custom Adaptation.")}var $9a74da07d11fdf6d$export$2e2bcd8739ae039=$9a74da07d11fdf6d$var$adaptParticle;function $843d76398a97f7ed$var$adaptParticleObject(id){const currentStore=$15882dbcd04d9f27$export$9d75f3e1a7e94aee(),currentEntity=($15882dbcd04d9f27$export$9e78cbb868ddafad(),$15882dbcd04d9f27$export$5676a8a1d49c85be());if(currentStore&&!currentStore.particles&&(currentStore.particles=[],currentStore.currentAdaptationIds.particle=0),currentStore){if(!(currentStore.currentAdaptationIds.particle in currentStore.particles)){let particle=currentEntity.getParticle({id:id});currentStore.particles[currentStore.currentAdaptationIds.particle]=particle}return currentStore.particles[currentStore.currentAdaptationIds.particle++]}throw new Error("adaptParticleObject() can only be used inside a Component or a Custom Adaptation.")}var $843d76398a97f7ed$export$2e2bcd8739ae039=$843d76398a97f7ed$var$adaptParticleObject;function $849cb7c2680d1324$var$adaptDerivative(id){const currentStore=$15882dbcd04d9f27$export$9d75f3e1a7e94aee(),currentStoreId=$15882dbcd04d9f27$export$9e78cbb868ddafad(),currentEntity=$15882dbcd04d9f27$export$5676a8a1d49c85be();if(currentStore&&!currentStore.derivatives&&(currentStore.derivatives=[],currentStore.currentAdaptationIds.derivative=0,currentStore.derivativeCleanups=[],currentStore.currentAdaptationIds.derivativeCleanup=0),currentStore){if(!(currentStore.currentAdaptationIds.derivative in currentStore.derivatives)){let derivative=currentEntity.getDerivative({id:id,storeId:currentStoreId});currentStore.derivatives[currentStore.currentAdaptationIds.derivative]=[derivative[0].state,derivative[0]],currentStore.derivativeCleanups[currentStore.currentAdaptationIds.derivativeCleanup]=derivative[1]}let derivative0=currentStore.derivatives[currentStore.currentAdaptationIds.derivative];return derivative0[0]=derivative0[1].state,currentStore.derivatives[currentStore.currentAdaptationIds.derivative++]}throw new Error("adaptDerivative() can only be used inside a Component or a Custom Adaptation.")}var $849cb7c2680d1324$export$2e2bcd8739ae039=$849cb7c2680d1324$var$adaptDerivative;function $6b02f44ed830e832$var$adaptDerivativeObject(id){const currentStore=$15882dbcd04d9f27$export$9d75f3e1a7e94aee(),currentEntity=($15882dbcd04d9f27$export$9e78cbb868ddafad(),$15882dbcd04d9f27$export$5676a8a1d49c85be());if(currentStore&&!currentStore.derivatives&&(currentStore.derivatives=[],currentStore.currentAdaptationIds.derivative=0,currentStore.derivativeCleanups=[],currentStore.currentAdaptationIds.derivativeCleanup=0),currentStore){if(!(currentStore.currentAdaptationIds.derivative in currentStore.derivatives)){let derivative=currentEntity.getDerivative({id:id});currentStore.derivatives[currentStore.currentAdaptationIds.derivative]=derivative}return currentStore.derivatives[currentStore.currentAdaptationIds.derivative++]}throw new Error("adaptDerivativeObject() can only be used inside a Component or a Custom Adaptation.")}var $6b02f44ed830e832$export$2e2bcd8739ae039=$6b02f44ed830e832$var$adaptDerivativeObject;function $926bb7bcfd7aed9a$var$adaptTrigger(id){const currentStore=$15882dbcd04d9f27$export$9d75f3e1a7e94aee(),currentEntity=($15882dbcd04d9f27$export$9e78cbb868ddafad(),$15882dbcd04d9f27$export$5676a8a1d49c85be());if(currentStore&&!currentStore.triggers&&(currentStore.triggers=[],currentStore.currentAdaptationIds.trigger=0),currentStore)return currentStore.currentAdaptationIds.trigger in currentStore.triggers||(currentStore.triggers[currentStore.currentAdaptationIds.trigger]=currentEntity.getTrigger({id:id})),currentStore.triggers[currentStore.currentAdaptationIds.trigger++];throw new Error("adaptTrigger() can only be used inside a Component or a Custom Adaptation.")}var $926bb7bcfd7aed9a$export$2e2bcd8739ae039=$926bb7bcfd7aed9a$var$adaptTrigger,$a40aa44e9b19fa09$export$2e2bcd8739ae039=$97020ee417fa4c70$export$2e2bcd8739ae039;export{$a40aa44e9b19fa09$export$2e2bcd8739ae039 as default,$926bb7bcfd7aed9a$export$2e2bcd8739ae039 as adaptTrigger,$ece177b0c5651317$export$2e2bcd8739ae039 as adaptEntity,$9a74da07d11fdf6d$export$2e2bcd8739ae039 as adaptParticle,$843d76398a97f7ed$export$2e2bcd8739ae039 as adaptParticleObject,$849cb7c2680d1324$export$2e2bcd8739ae039 as adaptDerivative,$6b02f44ed830e832$export$2e2bcd8739ae039 as adaptDerivativeObject};